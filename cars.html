<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Auto GBP ‚Äî –ê–≤—Ç–æ–º–æ–±—ñ–ª—ñ</title>

  <style>
    :root{
      --bg:#070a0f;
      --panel:rgba(255,255,255,.06);
      --panel2:rgba(255,255,255,.08);
      --stroke:rgba(255,255,255,.10);
      --text:#eef2ff;
      --muted:rgba(255,255,255,.65);
      --gold:#d7b66a;
      --gold2:#ffdf87;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --r:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      background:
        radial-gradient(1100px 600px at 20% -10%, rgba(215,182,106,.20), transparent 60%),
        radial-gradient(1000px 600px at 90% 10%, rgba(90,160,255,.10), transparent 55%),
        radial-gradient(900px 600px at 30% 110%, rgba(215,182,106,.14), transparent 60%),
        var(--bg);
      font-family: -apple-system, system-ui, Segoe UI, Roboto, Arial, sans-serif;
      overflow-x:hidden;
    }

    /* Safe areas */
    .safe{
      padding-top: calc(16px + env(safe-area-inset-top));
      padding-left: calc(14px + env(safe-area-inset-left));
      padding-right: calc(14px + env(safe-area-inset-right));
      padding-bottom: calc(18px + env(safe-area-inset-bottom));
      min-height: 100dvh; /* <- –∫–ª—é—á: –Ω–µ —Ä—ñ–∂–µ –Ω–∞ iOS */
    }

    a{color:inherit;text-decoration:none}
    .container{max-width:1100px;margin:0 auto}

    /* Top bar */
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding:10px 12px;
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      border-radius:22px;
      box-shadow: var(--shadow);
      position: sticky; top: calc(10px + env(safe-area-inset-top));
      z-index: 10;
      backdrop-filter: blur(10px);
    }
    .brand{
      display:flex; align-items:center; gap:10px; min-width: 160px;
    }
    .logoDot{
      width:34px;height:34px;border-radius:12px;
      border:1px solid rgba(215,182,106,.45);
      background: radial-gradient(circle at 30% 30%, rgba(255,223,135,.55), rgba(215,182,106,.18));
      box-shadow: 0 10px 30px rgba(215,182,106,.15);
    }
    .brand b{letter-spacing:.4px}
    .brand small{display:block;color:var(--muted);margin-top:2px;font-size:12px}

    .btnRow{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end}
    .btn{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 14px;
      border-radius:16px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.25);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      font-weight:700;
      white-space:nowrap;
    }
    .btn.gold{
      background:linear-gradient(180deg, rgba(255,223,135,.22), rgba(215,182,106,.12));
      border-color: rgba(215,182,106,.45);
    }
    .stats{
      display:flex; justify-content:space-between; gap:10px;
      padding:10px 4px 0;
      color: var(--muted);
      font-weight:700;
    }

    /* Filters */
    .filters{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1.2fr .8fr .6fr .6fr auto auto;
      gap:10px;
    }
    @media (max-width: 900px){
      .filters{grid-template-columns: 1fr 1fr; }
    }
    .field{
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);
      border-radius:16px;
      padding:10px 12px;
      display:flex; gap:8px; align-items:center;
    }
    .field input,.field select{
      width:100%;
      border:0; outline:0;
      background:transparent;
      color:var(--text);
      font-weight:700;
      font-size:14px;
      appearance:none;
    }
    .field input::placeholder{color:rgba(255,255,255,.45)}
    .smallBtn{
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.28);
      color:var(--text);
      border-radius:16px;
      padding:10px 14px;
      font-weight:800;
      cursor:pointer;
      min-height:42px;
    }
    .smallBtn.gold{
      border-color:rgba(215,182,106,.45);
      background:linear-gradient(180deg, rgba(255,223,135,.18), rgba(215,182,106,.10));
    }

    /* Grid */
    .grid{
      margin-top:14px;
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:14px;
    }
    @media (max-width: 980px){ .grid{grid-template-columns: repeat(2, minmax(0, 1fr));} }
    @media (max-width: 640px){ .grid{grid-template-columns: 1fr;} }

    .card{
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border-radius:22px;
      overflow:hidden;
      box-shadow: var(--shadow);
      display:flex; flex-direction:column;
    }
    .thumb{
      position:relative;
      aspect-ratio: 16 / 10;
      background:
        radial-gradient(600px 240px at 20% 20%, rgba(215,182,106,.18), transparent 55%),
        radial-gradient(600px 240px at 80% 30%, rgba(90,160,255,.10), transparent 55%),
        rgba(0,0,0,.25);
    }
    .thumb img{
      width:100%; height:100%;
      object-fit: cover;
      display:block;
      filter:saturate(1.05) contrast(1.05);
      transform: scale(1.01);
    }
    .badges{
      position:absolute; left:12px; right:12px; bottom:12px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .pillRow{display:flex; gap:8px; flex-wrap:wrap}
    .pill{
      padding:7px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.35);
      font-weight:900;
      font-size:12px;
      letter-spacing:.2px;
    }
    .pill.gold{border-color:rgba(215,182,106,.45); background:rgba(215,182,106,.12)}
    .mono{
      width:44px;height:44px;border-radius:16px;
      border:1px solid rgba(215,182,106,.45);
      background:linear-gradient(180deg, rgba(255,223,135,.22), rgba(215,182,106,.10));
      display:grid; place-items:center;
      font-weight:1000;
      color:#1a1205;
      box-shadow: 0 12px 30px rgba(215,182,106,.16);
    }
    .body{padding:14px 14px 16px}
    .hline{height:1px;background:rgba(255,255,255,.10); margin:12px 0}
    .titleRow{display:flex; justify-content:space-between; gap:10px; align-items:flex-start}
    .titleRow h3{margin:0;font-size:18px;line-height:1.15}
    .titleRow .sub{color:var(--muted);font-weight:800;margin-top:5px;font-size:13px}
    .price{font-weight:1000; color: var(--gold2); font-size:20px; white-space:nowrap}
    .kv{
      margin-top:12px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .kv .box{
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.22);
      border-radius:16px;
      padding:10px 12px;
    }
    .kv .box span{display:block;color:var(--muted);font-weight:900;font-size:12px}
    .kv .box b{display:block;margin-top:4px;font-size:14px}
    .actions{
      margin-top:12px;
      display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap;
    }
    .actions button, .actions a{
      border-radius:16px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.25);
      color:var(--text);
      padding:10px 12px;
      font-weight:900;
      cursor:pointer;
    }
    .actions .gold{
      border-color:rgba(215,182,106,.45);
      background:linear-gradient(180deg, rgba(255,223,135,.16), rgba(215,182,106,.10));
    }

    /* Modal */
    .modal{
      position:fixed; inset:0;
      display:none;
      background:rgba(0,0,0,.72);
      z-index: 50;
      padding: calc(14px + env(safe-area-inset-top)) 14px calc(14px + env(safe-area-inset-bottom));
    }
    .modal.open{display:block}
    .modalBox{
      max-width: 980px;
      margin:0 auto;
      border-radius:24px;
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .modalTop{
      display:flex; justify-content:space-between; align-items:center;
      padding:12px 14px;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .modalTop b{font-size:16px}
    .x{
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.25);
      color:var(--text);
      border-radius:14px;
      padding:8px 10px;
      font-weight:900;
      cursor:pointer;
    }
    .modalGrid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:0;
    }
    @media (max-width: 900px){
      .modalGrid{grid-template-columns: 1fr;}
    }

    .gallery{
      position:relative;
      background:rgba(0,0,0,.25);
    }
    .stage{
      aspect-ratio: 16/10;
      width:100%;
      overflow:hidden;
    }
    .stage img{
      width:100%; height:100%;
      object-fit:cover;
      display:block;
    }
    .navBtn{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      width:42px; height:42px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.35);
      color:var(--text);
      font-weight:1000;
      cursor:pointer;
      display:grid; place-items:center;
      backdrop-filter: blur(6px);
    }
    .navBtn.prev{left:10px}
    .navBtn.next{right:10px}
    .dots{
      position:absolute;
      left:0; right:0; bottom:10px;
      display:flex; gap:6px; justify-content:center;
    }
    .dot{
      width:8px;height:8px;border-radius:999px;
      background: rgba(255,255,255,.28);
      border:1px solid rgba(255,255,255,.18);
    }
    .dot.on{background: rgba(255,223,135,.85); border-color: rgba(215,182,106,.55)}
    .modalBody{
      padding:14px 14px 16px;
    }
    .mPrice{
      font-size:22px;
      font-weight:1000;
      color: var(--gold2);
      margin-top:6px;
    }
    .mNote{
      margin-top:10px;
      color: var(--muted);
      font-weight:800;
      line-height:1.35;
    }
    .mKv{
      margin-top:12px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .mKv .box{
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.18);
      border-radius:16px;
      padding:10px 12px;
    }
    .mKv span{display:block;color:var(--muted);font-weight:900;font-size:12px}
    .mKv b{display:block;margin-top:4px;font-size:14px}
    .mActions{
      margin-top:14px;
      display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;
    }
    .mActions a,.mActions button{
      border-radius:16px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.25);
      color:var(--text);
      padding:10px 12px;
      font-weight:900;
      cursor:pointer;
    }
    .mActions .gold{
      border-color:rgba(215,182,106,.45);
      background:linear-gradient(180deg, rgba(255,223,135,.16), rgba(215,182,106,.10));
    }
  </style>
</head>

<body>
  <div class="safe">
    <div class="container">

      <div class="topbar">
        <div class="brand">
          <div class="logoDot"></div>
          <div>
            <b>Auto GBP</b>
            <small>–ê–≤—Ç–æ–º–æ–±—ñ–ª—ñ</small>
          </div>
        </div>

        <div class="btnRow">
          <a class="btn gold" href="calculator.html">üßÆ –ü—Ä–æ—Ä–∞—Ö—É–≤–∞—Ç–∏</a>
          <a class="btn" id="writeTop" target="_blank" rel="noopener">üìù –ó–∞—è–≤–∫–∞</a>
        </div>
      </div>

      <div class="stats">
        <div id="counter">–ü–æ–∫–∞–∑–∞–Ω–æ: 0 –∑ 0</div>
        <div>–í—Å—å–æ–≥–æ: <span id="statTotal">0</span></div>
      </div>

      <div class="filters">
        <div class="field">üîé <input id="q" placeholder="–ü–æ—à—É–∫: Ford, Edge, Explorer..." /></div>
        <div class="field">üè∑Ô∏è
          <select id="brand">
            <option value="">–í—Å—ñ –±—Ä–µ–Ω–¥–∏</option>
          </select>
        </div>
        <div class="field">üìÖ <input id="yearMin" inputmode="numeric" placeholder="–†—ñ–∫ –≤—ñ–¥" /></div>
        <div class="field">üí∞ <input id="priceMax" inputmode="numeric" placeholder="–¶—ñ–Ω–∞ –¥–æ ($)" /></div>
        <button class="smallBtn gold" id="apply">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
        <button class="smallBtn" id="reset">–°–∫–∏–Ω—É—Ç–∏</button>
      </div>

      <div class="grid" id="grid"></div>

    </div>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="modalBox" id="modalBox">
      <div class="modalTop">
        <b id="mTitle">‚Äî</b>
        <button class="x" id="mClose">‚úï</button>
      </div>

      <div class="modalGrid">
        <div class="gallery">
          <div class="stage">
            <img id="mImg" alt="" />
          </div>
          <button class="navBtn prev" id="prev">‚Äπ</button>
          <button class="navBtn next" id="next">‚Ä∫</button>
          <div class="dots" id="dots"></div>
        </div>

        <div class="modalBody">
          <div class="mPrice" id="mPrice">$0</div>
          <div class="mNote" id="mNote"></div>

          <div class="mKv">
            <div class="box"><span>–†—ñ–∫</span><b id="mYear">‚Äî</b></div>
            <div class="box"><span>–ü—Ä–æ–±—ñ–≥</span><b id="mMileage">‚Äî</b></div>
            <div class="box"><span>–î–≤–∏–≥—É–Ω</span><b id="mEngine">‚Äî</b></div>
            <div class="box"><span>–ü—Ä–∏–≤—ñ–¥</span><b id="mDrive">‚Äî</b></div>
            <div class="box"><span>–õ–æ–∫–∞—Ü—ñ—è</span><b id="mLoc">‚Äî</b></div>
            <div class="box"><span>–°—Ç–∞—Ç—É—Å</span><b id="mStatus">‚Äî</b></div>
          </div>

          <div class="mActions">
            <button id="copy">üìã –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –¥–∞–Ω—ñ</button>
            <a class="gold" id="mWrite" target="_blank" rel="noopener">‚úâÔ∏è –ó–∞—è–≤–∫–∞</a>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    // ====== –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –ó–í'–Ø–ó–ö–£ ======
    const TELEGRAM_USERNAME = "AutoGBPBot"; // –±–µ–∑ @
    const PREFER = "telegram"; // "telegram" –∞–±–æ "whatsapp"
    const WHATSAPP_NUMBER = "380508232374"; // –±–µ–∑ +

    function writeLink(text){
      if (PREFER === "whatsapp"){
        return `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(text)}`;
      }
      // Telegram start (—Å—Ç–∞–±—ñ–ª—å–Ω–æ)
      return `https://t.me/${TELEGRAM_USERNAME}?start=${encodeURIComponent("cars")}`;
      // –Ø–∫—â–æ —Ç—Ä–µ–±–∞ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –Ω–∞–ø—Ä—è–º—É –∑ —Ç–µ–∫—Å—Ç–æ–º:
      // return `https://t.me/${TELEGRAM_USERNAME}?text=${encodeURIComponent(text)}`;
    }

    const topWrite = document.getElementById("writeTop");
    topWrite.href = writeLink("–ü—Ä–∏–≤—ñ—Ç! –•–æ—á—É –ø—ñ–¥—ñ–±—Ä–∞—Ç–∏ –∞–≤—Ç–æ. –ë—é–¥–∂–µ—Ç: ...");

    // ====== –î–ê–ù–Ü (—Ñ–æ—Ç–æ –∑ —Ç–≤–æ—ó—Ö –ø–∞–ø–æ–∫) ======
    // –í–ê–ñ–õ–ò–í–û: —à–ª—è—Ö–∏ —Ä–æ–±–∏–º–æ –ë–ï–ó –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ "/" —â–æ–± –Ω–µ –ª–∞–º–∞–ª–æ—Å—å —É –ø—ñ–¥–ø–∞–ø–∫–∞—Ö.
    const CARS = [
      {
        id:"edge2020",
        brand:"Ford",
        model:"Edge SEL",
        year:2020,
        note:"–ö–æ–º—Ñ–æ—Ä—Ç–Ω–∏–π –∫—Ä–æ—Å–æ–≤–µ—Ä –¥–ª—è –º—ñ—Å—Ç–∞ —Ç–∞ —Ç—Ä–∞—Å–∏",
        origin:"USA",
        status:"–ü—Ä–æ–¥–∞–Ω–∏–π",
        body:"SUV",
        drive:"AWD",
        engine:"2.0 EcoBoost",
        mileage:"105k km",
        location:"–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ",
        price:15700,
        tags:["–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ","–ö–æ–º—Ñ–æ—Ä—Ç"],
        photos:[
          "assets/cars/edge2020/IMG_5005.jpeg",
          "assets/cars/edge2020/IMG_5006.jpeg",
          "assets/cars/edge2020/IMG_5008.jpeg",
          "assets/cars/edge2020/IMG_5010.jpeg",
          "assets/cars/edge2020/IMG_5012.jpeg"
        ]
      },
      {
        id:"explorer2018",
        brand:"Ford",
        model:"Explorer",
        year:2018,
        note:"–°—ñ–º–µ–π–Ω–∏–π 7-–º—ñ—Å–Ω–∏–π, –≤–µ–ª–∏–∫–∏–π –±–∞–≥–∞–∂–Ω–∏–∫",
        origin:"USA",
        status:"–í –¥–æ—Ä–æ–∑—ñ",
        body:"SUV",
        drive:"AWD",
        engine:"3.7",
        mileage:"140k km",
        location:"–í –¥–æ—Ä–æ–∑—ñ",
        price:17500,
        tags:["–ü—ñ–¥–±—ñ—Ä","–°—ñ–º º—è","–ü–æ–¥–æ—Ä–æ–∂"],
        photos:[
          "assets/cars/explorer2018/IMG_5682.jpeg",
          "assets/cars/explorer2018/IMG_5683.jpeg",
          "assets/cars/explorer2018/IMG_5684.jpeg",
          "assets/cars/explorer2018/IMG_5685.jpeg",
          "assets/cars/explorer2018/IMG_5686.jpeg"
        ]
      }
    ];

    // ====== –†–ï–ù–î–ï–† ======
    const grid = document.getElementById("grid");
    const counter = document.getElementById("counter");
    const statTotal = document.getElementById("statTotal");

    const q = document.getElementById("q");
    const brandSel = document.getElementById("brand");
    const yearMin = document.getElementById("yearMin");
    const priceMax = document.getElementById("priceMax");
    const applyBtn = document.getElementById("apply");
    const resetBtn = document.getElementById("reset");

    const fmtMoney = n => `$${Number(n||0).toLocaleString("en-US")}`;
    const initials = (b,m) => (String(b||"")[0]||"A").toUpperCase() + (String(m||"")[0]||"G").toUpperCase();

    // brands
    [...new Set(CARS.map(c=>c.brand))].sort((a,b)=>a.localeCompare(b)).forEach(b=>{
      const o=document.createElement("option");
      o.value=b; o.textContent=b;
      brandSel.appendChild(o);
    });

    function cardHTML(c){
      const img = (c.photos && c.photos.length) ? c.photos[0] : "";
      const pills = [
        c.origin ? `<span class="pill gold">${escapeHtml(c.origin)}</span>` : "",
        c.status ? `<span class="pill">${escapeHtml(c.status)}</span>` : ""
      ].filter(Boolean).join("");

      return `
        <div class="card">
          <div class="thumb">
            ${img ? `<img src="${img}" alt="${escapeHtml(c.brand)} ${escapeHtml(c.model)}" loading="lazy" />` : ""}
            <div class="badges">
              <div class="pillRow">${pills}</div>
              <div class="mono">${initials(c.brand,c.model)}</div>
            </div>
          </div>

          <div class="body">
            <div class="titleRow">
              <div>
                <h3>${escapeHtml(c.brand)} ${escapeHtml(c.model)} ‚Ä¢ ${escapeHtml(c.year)}</h3>
                <div class="sub">${escapeHtml(c.note||"")}</div>
              </div>
              <div class="price">${fmtMoney(c.price)}</div>
            </div>

            <div class="kv">
              <div class="box"><span>–ö—É–∑–æ–≤</span><b>${escapeHtml(c.body||"‚Äî")}</b></div>
              <div class="box"><span>–ü—Ä–∏–≤—ñ–¥</span><b>${escapeHtml(c.drive||"‚Äî")}</b></div>
              <div class="box"><span>–î–≤–∏–≥—É–Ω</span><b>${escapeHtml(c.engine||"‚Äî")}</b></div>
              <div class="box"><span>–õ–æ–∫–∞—Ü—ñ—è</span><b>${escapeHtml(c.location||"‚Äî")}</b></div>
            </div>

            <div class="actions">
              <button class="gold" data-open="${c.id}">‚ÑπÔ∏è –î–µ—Ç–∞–ª—ñ</button>
              <a target="_blank" rel="noopener" href="${writeLink(`–•–æ—á—É –ø–æ –∞–≤—Ç–æ: ${c.brand} ${c.model} ${c.year}. –¶—ñ–Ω–∞: ${fmtMoney(c.price)}.`)}">‚úâÔ∏è –ó–∞—è–≤–∫–∞</a>
            </div>
          </div>
        </div>
      `;
    }

    function render(list){
      grid.innerHTML = list.map(cardHTML).join("");
      counter.textContent = `–ü–æ–∫–∞–∑–∞–Ω–æ: ${list.length} –∑ ${CARS.length}`;
      statTotal.textContent = CARS.length;

      grid.querySelectorAll("[data-open]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-open");
          const car = CARS.find(x=>x.id===id);
          if (car) openModal(car);
        });
      });
    }

    function applyFilters(){
      const qq = (q.value||"").trim().toLowerCase();
      const bb = brandSel.value || "";
      const yMin = Number(yearMin.value || 0);
      const pMax = Number(priceMax.value || 0);

      let list = CARS.slice();
      if (qq){
        list = list.filter(c => `${c.brand} ${c.model}`.toLowerCase().includes(qq));
      }
      if (bb){
        list = list.filter(c => c.brand === bb);
      }
      if (yMin){
        list = list.filter(c => Number(c.year||0) >= yMin);
      }
      if (pMax){
        list = list.filter(c => Number(c.price||0) <= pMax);
      }
      render(list);
    }

    applyBtn.addEventListener("click", applyFilters);
    resetBtn.addEventListener("click", ()=>{
      q.value=""; brandSel.value=""; yearMin.value=""; priceMax.value="";
      applyFilters();
    });
    [q, yearMin, priceMax].forEach(el=>{
      el.addEventListener("keydown", (e)=>{ if (e.key==="Enter") applyFilters(); });
    });
    brandSel.addEventListener("change", applyFilters);

    // ====== MODAL + GALERY ======
    const modal = document.getElementById("modal");
    const mClose = document.getElementById("mClose");
    const mTitle = document.getElementById("mTitle");
    const mPrice = document.getElementById("mPrice");
    const mNote = document.getElementById("mNote");
    const mYear = document.getElementById("mYear");
    const mMileage = document.getElementById("mMileage");
    const mEngine = document.getElementById("mEngine");
    const mDrive = document.getElementById("mDrive");
    const mLoc = document.getElementById("mLoc");
    const mStatus = document.getElementById("mStatus");
    const mWrite = document.getElementById("mWrite");
    const mImg = document.getElementById("mImg");
    const dots = document.getElementById("dots");
    const prev = document.getElementById("prev");
    const next = document.getElementById("next");
    const copy = document.getElementById("copy");

    let currentCar = null;
    let idx = 0;

    function setImg(){
      const list = (currentCar?.photos || []);
      const src = list[idx] || "";
      if (!src){
        mImg.src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1200' height='700'%3E%3Crect width='100%25' height='100%25' fill='%23070a0f'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%23d7b66a' font-family='Arial' font-size='46'%3EAuto%20GBP%3C/text%3E%3C/svg%3E";
      } else {
        mImg.src = src;
      }
      // dots
      dots.innerHTML = list.map((_,i)=>`<span class="dot ${i===idx?'on':''}"></span>`).join("");
      prev.style.display = list.length > 1 ? "grid" : "none";
      next.style.display = list.length > 1 ? "grid" : "none";
    }

    function openModal(c){
      currentCar = c;
      idx = 0;

      mTitle.textContent = `${c.brand} ${c.model}`;
      mPrice.textContent = fmtMoney(c.price);
      mNote.textContent = c.note || "";
      mYear.textContent = c.year || "‚Äî";
      mMileage.textContent = c.mileage || "‚Äî";
      mEngine.textContent = c.engine || "‚Äî";
      mDrive.textContent = c.drive || "‚Äî";
      mLoc.textContent = c.location || "‚Äî";
      mStatus.textContent = c.status || "‚Äî";
      mWrite.href = writeLink(`–•–æ—á—É –ø–æ –∞–≤—Ç–æ: ${c.brand} ${c.model} ${c.year}. –¶—ñ–Ω–∞: ${fmtMoney(c.price)}.`);

      setImg();

      modal.classList.add("open");
      modal.setAttribute("aria-hidden","false");
      // —â–æ–± —Ñ–æ–Ω –Ω–µ ‚Äú—Å—Ç—Ä–∏–±–∞—î‚Äù
      document.body.style.overflow = "hidden";
    }

    function closeModal(){
      modal.classList.remove("open");
      modal.setAttribute("aria-hidden","true");
      document.body.style.overflow = "";
      currentCar = null;
    }

    mClose.addEventListener("click", closeModal);
    modal.addEventListener("click", (e)=>{ if (e.target === modal) closeModal(); });
    document.addEventListener("keydown", (e)=>{ if (e.key==="Escape") closeModal(); });

    prev.addEventListener("click", ()=>{
      const len = (currentCar?.photos||[]).length;
      if (len < 2) return;
      idx = (idx - 1 + len) % len;
      setImg();
    });
    next.addEventListener("click", ()=>{
      const len = (currentCar?.photos||[]).length;
      if (len < 2) return;
      idx = (idx + 1) % len;
      setImg();
    });

    // swipe (–º'—è–∫–æ, –±–µ–∑ –±—ñ–±–ª—ñ–æ—Ç–µ–∫)
    let startX = 0;
    mImg.addEventListener("touchstart", (e)=>{ startX = e.touches[0].clientX; }, {passive:true});
    mImg.addEventListener("touchend", (e)=>{
      const endX = (e.changedTouches[0]?.clientX || 0);
      const dx = endX - startX;
      if (Math.abs(dx) < 35) return;
      if (dx > 0) prev.click(); else next.click();
    }, {passive:true});

    copy.addEventListener("click", async ()=>{
      if (!currentCar) return;
      const c = currentCar;
      const txt =
`Auto GBP ‚Äî –ê–≤—Ç–æ
${c.brand} ${c.model}
–†—ñ–∫: ${c.year}
–¶—ñ–Ω–∞: ${fmtMoney(c.price)}
–ü—Ä–æ–±—ñ–≥: ${c.mileage || "‚Äî"}
–î–≤–∏–≥—É–Ω: ${c.engine || "‚Äî"}
–ü—Ä–∏–≤—ñ–¥: ${c.drive || "‚Äî"}
–°—Ç–∞—Ç—É—Å: ${c.status || "‚Äî"}`;
      try{
        await navigator.clipboard.writeText(txt);
        const old = copy.textContent;
        copy.textContent = "‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ";
        setTimeout(()=>copy.textContent = old, 1200);
      }catch{
        alert("–ù–µ –≤–¥–∞–ª–æ—Å—è —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏. –°–ø—Ä–æ–±—É–π –≤—Ä—É—á–Ω—É.");
      }
    });

    function escapeHtml(str){
      return String(str ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // init
    render(CARS);
  </script>
</body>
</html>
